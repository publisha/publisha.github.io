<!DOCTYPE html>
<html lang="en-gb">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Editing inside the ePUB package
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/jquery.fancybox.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/guide.css">
  <link rel="stylesheet" href="/public/css/bigfoot-default.css">

  <!-- Fonts -->
  <!-- can't use google fonts on GitHub unless https -->
<link href='https://fonts.googleapis.com/css?family=Cantarell:regular,italic,bold,bolditalic' rel='stylesheet'>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

<!-- Optionally make the images go full width but put this in the page metadata -->


<style>
code {
  white-space: pre-wrap;
}
.code pre {
  white-space: pre-wrap;
  word-wrap: break-word;
}
</style>


<!-- javascripts for fancybox -->
<script type="text/javascript" src="/public/js/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="/public/js/jquery.fancybox.pack.js">
</script>
<script type="text/javascript" src="/public/js/jquery.fancybox-media.js">
</script>
  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- javascript for the footnote popups -->
<script type="text/javascript" src="/public/js/bigfoot.js"></script>
<script type="text/javascript">
    $.bigfoot();
</script>

</head>


  <body class="theme-base-0b">
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->

<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">
<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <nav class="sidebar-nav"  style="border-bottom:none !important;">
    <a href="/"><i class="sidebar-nav-item fa fa-home fa-2x" aria-hidden="true"></i></a>
  </nav>
  <div class="sidebar-item" style="padding-top:0;padding-bottom:.5rem;">
    <p>tutorials and screencasts about digital publishing and eBook Production</p>
  </div>

  <nav class="sidebar-nav">
    <!-- <a class="sidebar-nav-item" href="/"><i class="fa fa-home fa-lg" aria-hidden="true"> </i>Home</a> -->

    

    <!-- 
    
    
    
    
      
    
    
    
      
        <a class="sidebar-nav-item" href="/pages/about/">About</a>
      
    
    
    
      
    
    
    
      
        <a class="sidebar-nav-item" href="/pages/buildingaTOCinInDesign/">Building the TOC in InDesign</a>
      
    
    
    
      
        <a class="sidebar-nav-item" href="/pages/id2xml/">Create XML from InDesign</a>
      
    
    
    
      
        <a class="sidebar-nav-item" href="/pages/id2reflowable/">Creating a Reflowable eBook</a>
      
    
    
    
      
        <a class="sidebar-nav-item active" href="/pages/editing_ePub/">Editing inside the ePUB package</a>
      
    
    
    
      
    
    
    
      
    
    
    
      
        <a class="sidebar-nav-item" href="/pages/eRecipeBook/">Making an eBook of Recipes</a>
      
    
    
    
      
        <a class="sidebar-nav-item" href="/pages/create_speare_play_web/">Repository for Shakespeare Play Web page</a>
      
    
    
    
      
        <a class="sidebar-nav-item" href="/pages/screencasts/">Screencasts from the PagetoScreen YouTube Channel</a>
      
    
    
    
      
        <a class="sidebar-nav-item" href="/pages/htmlcssthebasics/">The basics of HTML and CSS</a>
      
    
    
    
      
        <a class="sidebar-nav-item" href="/pages/attentiontodetail/">Typographic detail with InDesign</a>
      
    
    
    
      
        <a class="sidebar-nav-item" href="/pages/InDesignBookPanel/">Using the Book Panel in InDesign</a>
      
    
     -->

<ul class="navigation">
<li class="header">Pages by Category</li>

  <li class="dropdown"><a href="#">InDesign <i class="fa fa-caret-down" aria-hidden="true"></i></a>
    <ul>
    
     
    
     
          
            <li><a href="/pages/InDesignBookPanel/">Using the Book Panel in InDesign <i class="fa fa-caret-right" aria-hidden="true"></i></a></li>
          
        
    
     
    
     
    
     
    
     
          
            <li><a href="/pages/attentiontodetail/">Typographic detail with InDesign <i class="fa fa-caret-right" aria-hidden="true"></i></a></li>
          
        
          
        
    
     
          
            <li><a href="/pages/buildingaTOCinInDesign/">Building the TOC in InDesign <i class="fa fa-caret-right" aria-hidden="true"></i></a></li>
          
        
    
     
          
        
    
     
          
            <li><a href="/pages/eRecipeBook/">Making an eBook of Recipes <i class="fa fa-caret-right" aria-hidden="true"></i></a></li>
          
        
          
        
    
     
          
        
    
     
          
        
          
        
    
     
          
            <li><a href="/pages/id2reflowable/">Creating a Reflowable eBook <i class="fa fa-caret-right" aria-hidden="true"></i></a></li>
          
        
          
        
    
     
          
            <li><a href="/pages/id2xml/">Create XML from InDesign <i class="fa fa-caret-right" aria-hidden="true"></i></a></li>
          
        
          
        
    
     
    
     
    
     
    
    </ul>
  </li>
      
  <li class="dropdown"><a href="#">HTML <i class="fa fa-caret-down" aria-hidden="true"></i></a>
    <ul>
    
     
    
     
          
        
    
     
    
     
    
     
    
     
          
        
          
        
    
     
          
        
    
     
          
        
    
     
          
        
          
        
    
     
          
        
    
     
          
            <li><a href="/pages/htmlcssthebasics/">The basics of HTML and CSS <i class="fa fa-caret-right" aria-hidden="true"></i></a></li>
          
        
          
        
    
     
          
        
          
        
    
     
          
        
          
        
    
     
    
     
    
     
    
    </ul>
  </li>
      
  <li class="dropdown"><a href="#">CSS <i class="fa fa-caret-down" aria-hidden="true"></i></a>
    <ul>
    
     
    
     
          
        
    
     
    
     
    
     
    
     
          
        
          
        
    
     
          
        
    
     
          
        
    
     
          
        
          
        
    
     
          
        
    
     
          
        
          
            <li><a href="/pages/htmlcssthebasics/">The basics of HTML and CSS <i class="fa fa-caret-right" aria-hidden="true"></i></a></li>
          
        
    
     
          
        
          
        
    
     
          
        
          
        
    
     
    
     
    
     
    
    </ul>
  </li>
      
  <li class="dropdown"><a href="#">Typography <i class="fa fa-caret-down" aria-hidden="true"></i></a>
    <ul>
    
     
    
     
          
        
    
     
    
     
    
     
    
     
          
        
          
            <li><a href="/pages/attentiontodetail/">Typographic detail with InDesign <i class="fa fa-caret-right" aria-hidden="true"></i></a></li>
          
        
    
     
          
        
    
     
          
        
    
     
          
        
          
        
    
     
          
        
    
     
          
        
          
        
    
     
          
        
          
        
    
     
          
        
          
        
    
     
    
     
    
     
    
    </ul>
  </li>
      
  <li class="dropdown"><a href="#">Using GitHub <i class="fa fa-caret-down" aria-hidden="true"></i></a>
    <ul>
    
     
    
     
          
        
    
     
    
     
    
     
    
     
          
        
          
        
    
     
          
        
    
     
          
            <li><a href="/pages/create_speare_play_web/">Repository for Shakespeare Play Web page <i class="fa fa-caret-right" aria-hidden="true"></i></a></li>
          
        
    
     
          
        
          
        
    
     
          
        
    
     
          
        
          
        
    
     
          
        
          
        
    
     
          
        
          
        
    
     
    
     
    
     
    
    </ul>
  </li>
      
  <li class="dropdown"><a href="#">XML <i class="fa fa-caret-down" aria-hidden="true"></i></a>
    <ul>
    
     
    
     
          
        
    
     
    
     
    
     
    
     
          
        
          
        
    
     
          
        
    
     
          
        
    
     
          
        
          
        
    
     
          
        
    
     
          
        
          
        
    
     
          
        
          
        
    
     
          
        
          
            <li><a href="/pages/id2xml/">Create XML from InDesign <i class="fa fa-caret-right" aria-hidden="true"></i></a></li>
          
        
    
     
    
     
    
     
    
    </ul>
  </li>
      
  <li class="dropdown"><a href="#">ePub <i class="fa fa-caret-down" aria-hidden="true"></i></a>
    <ul>
    
     
    
     
          
        
    
     
    
     
    
     
    
     
          
        
          
        
    
     
          
        
    
     
          
        
    
     
          
        
          
            <li><a href="/pages/eRecipeBook/">Making an eBook of Recipes <i class="fa fa-caret-right" aria-hidden="true"></i></a></li>
          
        
    
     
          
            <li><a href="/pages/editing_ePub/">Editing inside the ePUB package <i class="fa fa-caret-right" aria-hidden="true"></i></a></li>
          
        
    
     
          
        
          
        
    
     
          
        
          
            <li><a href="/pages/id2reflowable/">Creating a Reflowable eBook <i class="fa fa-caret-right" aria-hidden="true"></i></a></li>
          
        
    
     
          
        
          
        
    
     
    
     
    
     
    
    </ul>
  </li>
      
</ul>


    <!-- 
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/pages/InDesignBookPanel/">Using the Book Panel in InDesign</a>
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/pages/about/">About</a>
        
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="/pages/attentiontodetail/">Typographic detail with InDesign</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/pages/buildingaTOCinInDesign/">Building the TOC in InDesign</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/pages/create_speare_play_web/">Repository for Shakespeare Play Web page</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/pages/eRecipeBook/">Making an eBook of Recipes</a>
        
      
    
      
        
          <a class="sidebar-nav-item active" href="/pages/editing_ePub/">Editing inside the ePUB package</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/pages/htmlcssthebasics/">The basics of HTML and CSS</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/pages/id2reflowable/">Creating a Reflowable eBook</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/pages/id2xml/">Create XML from InDesign</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/pages/screencasts/">Screencasts from the PagetoScreen YouTube Channel</a>
        
      
     -->
<!-- <a class="sidebar-nav-item" href="/blog/">Articles</a> -->
    
     <a class="sidebar-nav-item" href="/blog">Blog Articles</a>
     <a class="sidebar-nav-item" href="/pages/screencasts/">Screencasts</a>
    <span class="sidebar-nav-item">Currently v0.11</span>
    <!-- <a class="sidebar-nav-item" href="http://prose.io/#Pageboy/Islomania">Edit</a> -->
  </nav>

  <div class="sidebar-item">
    <p>
      <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><i class="fa fa-copyright" aria-hidden="true"></i> Chris Jennings</a> 2017
    </p>
  </div>
  <div class="sidebar-item">
    <p>
      <b>Note:</b> Images can be enlarged by click or touch
    </p>
  </div>
  <!-- <div class="sidebar-item cclicense">
    <p>
      <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons Licence" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png" /></a>
    </p>
  </div> -->
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Digital Publisher Guide</a><br />
            <small>Help for publishers and students of publishing</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="page">
  <!-- <h1 class="page-title">Editing inside the ePUB package</h1> -->
  <!-- TOC depthFrom:2 depthTo:2 withLinks:1 updateOnSave:1 orderedList:0 -->
<section class="toc">
  <h2 id="on-this-page">On this Page</h2>

  <ul>
    <li><a href="#unpacking">Unpacking</a></li>
    <li><a href="#repacking">Repacking</a></li>
    <li><a href="#can-we-edit">Can we Edit?</a></li>
    <li><a href="#test-and-view-our-changes">Test and View Our Changes</a></li>
    <li><a href="#changes-to-the-css">Changes to the CSS.</a></li>
    <li><a href="#footnote-references">Footnote References</a></li>
    <li><a href="#typography">Typography</a></li>
    <li><a href="#the-opf-package-document">The OPF Package Document</a></li>
    <li><a href="#the-cover">The Cover</a></li>
    <li><a href="#the-spine">The Spine</a></li>
    <li><a href="#the-guide-section">The Guide Section</a></li>
    <li><a href="#the-metadata-block">The Metadata Block</a></li>
    <li><a href="#orientation-and-spreads">Orientation and Spreads</a></li>
    <li><a href="#the-navigation-document-tocxhtml">The Navigation Document (toc.xhtml)</a></li>
    <li><a href="#landmarks">Landmarks</a></li>
    <li><a href="#how-can-the-landmarks-help-in-the-way-the-ebook-is-read">How can the Landmarks help in the way the eBook is read?</a></li>
    <li><a href="#pages-outside-the-flow">Pages Outside the Flow</a></li>
    <li><a href="#non-linear-content">Non-Linear Content</a></li>
    <li><a href="#displaying-the-table-of-contents-as-a-page">Displaying the Table of Contents as a Page</a></li>
    <li><a href="#adding-javascript">Adding Javascript</a></li>
    <li><a href="#adding-content-with-javascript">Adding Content with Javascript</a></li>
    <li><a href="#adding-content-with-css">Adding Content with CSS</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>

</section>
<!-- /TOC -->
<h1 id="editing-inside-the-epub-package">Editing inside the ePUB package</h1>

<p>When we have created a reflowable ePub by exporting from InDesign, we may find that there are some stylistic details that need tidying up, changing or even correcting. Not all aspects of our wonderfully crafted typographic design work will give perfect results in the ePub.</p>

<p>Some text editors have the functionality to edit the components of the ePUB package even without unpacking. BBedit is the one I have used, but Oxygen XML will also give you that ability. Oxygen is more sophisticated and expensive; it will allow you to remove and add files into the package, so if you wanted replace a picture, Oxygen will do it!</p>

<p>These days I use Atom as my text editor and so, although you can view the insides of the ePub package, you need to unpack before editing.</p>

<p><a href="/images/2017/02/editing_ePub/atomfilelist.png"><img src="/images/2017/02/editing_ePub/atomfilelist.png" alt="Here we see the files within the ePub package using Atom" /></a></p>

<h2 id="unpacking">Unpacking</h2>

<p>A more flexible approach is to unpack the ePUB package and get access to all of the components, make your changes and then repack. If you have access to Adobe Dreamweaver, then you can use this web design tool to make your edits. If you are a web developer, then you will be familiar with the relationship between the files that display the ePUB — namely the HTML, CSS and image files.</p>

<p>The ePUB file created on export from InDesign is actually a package of files wrapped up in a ZIP file. You probably have come across ZIP files before; they are useful when you want to send someone a bunch of files or when you want to save some disk space by compressing large files. If you are a MAC user then you may have used the ‘compress’ utility found when you right-click over a folder or file. PC users may have used other ZIP utilities for compressing or unzipping files. The ePUB file that you now have from InDesign is actually a ZIP but the file extension is .epub.</p>

<p>There are some particular features of the way this file is compressed into a package, and this is what makes it slightly different from a regular ZIP file. We can easily unpack the file by renaming as a .zip file and using an unzip utility. The problem comes when we want to re-pack into the ePUB file, because one of the files inside this package needs to uncompressed and first in the order.</p>

<h2 id="repacking">Repacking</h2>

<p>To achieve this re-packing correctly we need to use a script that will add items back into a new ePUB package. If you are working within the MAC environment then I suggest downloading <em>ePub Zip/Unzip</em> - a script that will, not only, unpack the ePUB but repackage after editing. On a PC (Windows), this is slightly more complex; you will need first to rename the file, with .zip instead of .epub. Then use an unzip utility, to extract the files. You can then edit the components, but to repack, you cannot simply re-ZIP. You need to download a utility called <em>ePubPack.</em></p>

<h3 id="mac-users">MAC Users</h3>

<p>If you are a MAC user I recommend that you grab a copy of the ePUB Zip/Unzip Applescript, because you can add this to your Finder toolbar and then simply drag the ePUB file onto the icon. This will create the folder of files.</p>

<p><a href="/images/2017/02/editing_ePub/image2.png"><img src="/images/2017/02/editing_ePub/image2.png" alt="Here is the icon for the script to unpack the ePub package." /></a></p>

<p>Once you have completed your editing tasks and are ready to test, simply drag the folder onto the icon and the script will repack the folder into the ePUB, with the same name (warning you that it will overwrite the original).</p>

<h2 id="can-we-edit">Can we Edit?</h2>

<p>It really depends on the software tools that you have.</p>

<p>I tend to use Atom as the text editor, and once you have unpacked the ePub (using the script just described), then you can drag the complete folder onto the Atom app, and this will then become a project that you can edit.</p>

<p><a href="/images/2017/02/editing_ePub/epubinAtom.png"><img src="/images/2017/02/editing_ePub/epubinAtom.png" alt="The ePub package open for editing with Atom" /></a></p>

<h3 id="what-can-we-edit">What Can We edit?</h3>

<p>This really depends on how the ePUB looks after export from InDesign and what changes you want to make, but crucially you need to keep your options open to go back to InDesign to make further changes. This means avoiding the editing of the XHTML documents and just focussing on the stylesheets.</p>

<p>In our workflow we plan to return to InDesign for further edits, so let us explore how to create our own copy of the stylesheet (CSS), that we can link back in the next time we export to the ePUB.</p>

<h3 id="how-many-css-files-do-we-have">How many CSS files do we have?</h3>

<p>If you have used the InDesign book panel to organise your content, you are gong to find several CSS files; one main file with a filename- <code class="highlighter-rouge">idGeneratedStyles_0.css</code> and then further stylesheets one for each of the documents in your book panel.</p>

<p>The main CSS file is where the generic styles are located (those which are common throughout the eBook), and then each of the others will only include style information for elements present in those separate XHTML files.</p>

<p>All we want to do at this stage is to edit the stylesheet called <code class="highlighter-rouge">idGeneratedStyles_0.css</code>.</p>

<h3 id="our-first-correction">Our First Correction</h3>

<p>You will remember from our previous chapter that we found that an offer rule that provided a background grey block to the Act heading had disappeared when we views the ePUB. Here is a reminder:</p>

<p><a href="/images/2017/02/editing_ePub/image3.png"><img src="/images/2017/02/editing_ePub/image3.png" alt="An indicator showing the missing Act heading" /></a></p>

<p>The reason for this error is that InDesign does not export the rules (lines) above or below the paragraphs from the paragraph style settings, and our tex is white so it disappears.</p>

<blockquote>
  <p><strong>Version alert:</strong> Since InDesign 2015 edition it is possible to use <code class="highlighter-rouge">background Shading</code> in a paragraph style, so we might us this instead of offsetting a paragraph rule.</p>
</blockquote>

<p>The correction we need to make is in</p>

<p><code class="highlighter-rouge">idGeneratedStyles_0.css</code></p>

<p>In our Export Tagging setting we configured the paragraph style called act to use the tag - h1 with a class name of ‘act’. We then look for and find this block in the CSS:</p>

<p><a href="/images/2017/02/editing_ePub/image4.png"><img src="/images/2017/02/editing_ePub/image4.png" alt="The setting for the paragraph rule that gives a background to the text." /></a></p>

<p>We need to add the following line:</p>

<p><code class="highlighter-rouge">background-color:#a196a0;</code></p>

<p>I grabbed the hexadecimal value of the colour from InDesign.</p>

<p>We can make adjustments to the height of this block of colour by adjusting the leading – in CSS this is the line-height:</p>

<p><code class="highlighter-rouge">line-height:1.5;</code></p>

<p><a href="/images/2017/02/editing_ePub/image5.png"><img src="/images/2017/02/editing_ePub/image5.png" alt="The styles that InDesign has given us." /></a></p>

<h2 id="test-and-view-our-changes">Test and View Our Changes</h2>

<p>If you want to view one of your XHTML files when open in Atom, you should obtain an extension called HTML-Preview. With this you can view the page simply. On the other hand, just opening the XHTML file in a web browser will also give a good idea of the result.</p>

<p><a href="/images/2017/02/editing_ePub/epubinAtomwithpreview.png"><img src="/images/2017/02/editing_ePub/epubinAtomwithpreview.png" alt="With the extension to Atom - HTML-Preview we can see the results of our changes right away." /></a></p>

<h3 id="roundtrip-to-indesign">Roundtrip to InDesign</h3>

<p>If we need to return to InDesign then we will lose these corrections that we make to the CSS, because InDesign will generate the same ones again. We have 2 approaches to solving this:</p>

<p>Once you have made the corrections that solve the style and display issues, then you can take a copy of the CSS file and save this somewhere in your working files with a logical name (mine is dream.css). The next time that you export the ePUB, we can then select this external CSS file (see the CSS panel when exporting), and this will be added in the head of each XHTML file.</p>

<p>Here we see the listed CSS files - 2 generated by InDesign and one of our own making. This custom one should come after the other 2 so that your rules will override the ones that InDesign has put in.</p>

<p><a href="/images/2017/02/editing_ePub/mystyles.png"><img src="/images/2017/02/editing_ePub/mystyles.png" alt="here we see how the mystyles.css has been added" /></a></p>

<h2 id="changes-to-the-css">Changes to the CSS.</h2>

<h3 id="the-page-breaks">The page breaks</h3>

<p>Each of the XHTML pages represents a new chapter or section (or Act / Scene of the play), and will therefore begin a new page. This has happened because you opted to have the style for the Act or Scene to ‘Split the ePUB’ on export. The paragraph style in the play is ‘act’ and the resulting HTML is:</p>

<p><code class="highlighter-rouge">&lt;h1 class="act"&gt;</code></p>

<p>Because for print we also set this up to Start on a New Page (in fact - On Next Odd Page under the Keep Options), InDesign has been less than helpful by applying a rule to the CSS as follows:</p>

<p><code class="highlighter-rouge">page-break-before:always;</code></p>

<p>Guess what! This means that you may get a blank page, because the ePUB gives the eReader software 2 reasons to start a new page</p>

<ol>
  <li>It starts a new page because we split the ePub into separate HTML files at the Act start</li>
  <li>And then because we use ‘Keep Option’ we get the CSS above.</li>
</ol>

<p>The line in the CSS will need to be changed to:</p>

<p><code class="highlighter-rouge">page-break-before:auto;</code></p>

<h2 id="footnote-references">Footnote References</h2>

<p>In a printed book the footnotes are at the bottom of the page and the references in the text are usually a superscript number (slightly smaller in size and elevated next to the appropriate context.</p>

<p><a href="/images/2017/02/editing_ePub/image8.png"><img src="/images/2017/02/editing_ePub/image8.png" alt="Footnote references are superscript numbers" /></a></p>

<p>In our eBook version we can opt for the footnotes to become popup notes (supported in ePUB3 in Apple’s iBooks software and the recent Kindles. However, the little superscript number are very difficult to spot and even more difficult for the finger to touch, so I suggest making then stand out a bit more by adjusting the CSS to give a background colour and slight increase in size.</p>

<p><a href="/images/2017/02/editing_ePub/image9.png"><img src="/images/2017/02/editing_ePub/image9.png" alt="Here is the popup text showing a re-styled reference number" /></a></p>

<p>In the CSS we need to edit these lines to the rule for the reference element:</p>

<div class="language-css highlighter-rouge"><pre class="codehilite"><code><span class="nt">span</span><span class="nc">.reference</span> <span class="p">{</span>
 <span class="nl">color</span><span class="p">:</span><span class="m">#cc071e</span><span class="p">;</span>
 <span class="nl">font-variant</span><span class="p">:</span><span class="nb">normal</span><span class="p">;</span>
 <span class="nl">text-transform</span><span class="p">:</span><span class="nb">none</span><span class="p">;</span>
 <span class="nl">vertical-align</span><span class="p">:</span><span class="nb">super</span><span class="p">;</span>
 <span class="nl">font-size</span><span class="p">:</span><span class="m">1.6em</span><span class="p">;</span>
 <span class="nl">color</span><span class="p">:</span><span class="no">white</span><span class="p">;</span>
 <span class="nl">background</span><span class="p">:</span><span class="m">#cc071e</span><span class="p">;</span>
 <span class="nl">padding</span><span class="p">:</span><span class="m">3px</span><span class="p">;</span>
 <span class="nl">font-weight</span><span class="p">:</span><span class="nb">bold</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="typography">Typography</h2>

<p>In our print book we have 2 columns in the introduction text and we have set this to be justified.</p>

<p><a href="/images/2017/02/editing_ePub/image10.png"><img src="/images/2017/02/editing_ePub/image10.png" alt="preint version shows 2 coloumns" /></a></p>

<p>When this arrives in the ePUB (reflowable), we find only one column but the text is justified. Maybe we are happy with this, but if not we need to change the CSS in the body text rule from:</p>

<p><code class="highlighter-rouge">text-align:justify;</code></p>

<p>to</p>

<p><code class="highlighter-rouge">text-align:left;</code></p>

<p>If you delete the line altogether, the user will control the text alignment, in their eReader software settings.</p>

<p>If the intention is to go back to InDesign in this workflow / editorial cycle, then you should avoid editing anything other than the CSS. Your objective (wherever possible) is to avoid editing the XHTML pages. Once you edit any other files inside the ePUB package, then roundtrip to InDesign will be difficult.</p>

<p>If your workflow requires that you edit the ePUB in order to consult the other members of your creative team or even a client, then you should copy and record the changes that you make so you can wind these changes back int a new version.</p>

<p>The other modifications that you may need to make are as follows.</p>

<h2 id="the-opf-package-document">The OPF Package Document</h2>

<p>If you exported from InDesign this file will be named <code class="highlighter-rouge">content.opf</code></p>

<p>There are a number of adjustments that can be made to the OPF file that will affect the way that the ePUB is displayed. Some of these settings are particular for iBooks on iPad, but there are some settings that are generic and are needed for other devices and platforms.</p>

<h2 id="the-cover">The Cover</h2>

<p>You will find references to the cover in 3 places in the content.opf file.</p>

<div class="language-html highlighter-rouge"><pre class="codehilite"><code><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"cover"</span> <span class="na">content=</span><span class="s">"msnd_cover15.jpg"</span> <span class="nt">/&gt;</span>
</code></pre>
</div>

<p>This is a line required only for backwards compatibility for ePUB2 and is not really need but leave this alone!</p>

<div class="language-html highlighter-rouge"><pre class="codehilite"><code><span class="nt">&lt;item</span> <span class="na">id=</span><span class="s">"cover"</span> <span class="na">href=</span><span class="s">"cover.xhtml"</span> <span class="na">media-type=</span><span class="s">"application/xhtml+xml"</span><span class="nt">&gt;</span>
</code></pre>
</div>

<p>In my case this is a separate page that can optionally display the cover. In other words, this refers to an XHTML page that includes a link to the image source. However, the item in the spine section that refers to this looks like this:</p>

<div class="language-html highlighter-rouge"><pre class="codehilite"><code><span class="nt">&lt;itemref</span> <span class="na">idref=</span><span class="s">"cover"</span> <span class="na">linear=</span><span class="s">"no"</span><span class="nt">&gt;</span>
</code></pre>
</div>

<p>and the <code class="highlighter-rouge">linear="no"</code> attribute means that this page will never show unless it is linked from elsewhere - for example - the table of contents.</p>

<p>So, if you would like your users to be able to navigate back to the cover, then you can remove <code class="highlighter-rouge">linear="no"</code>, so that the cover itself is part of the book flow, and can be seen as the first page in the book. Note: Do not do this if you intend to convert to the Kindle version, because you will then have the cover showing twice!</p>

<p>We are not done with the cover yet! There is another line required for the ePUB3 format and you will find this in the <code class="highlighter-rouge">&lt;metadata&gt;</code> section:</p>

<div class="language-html highlighter-rouge"><pre class="codehilite"><code><span class="nt">&lt;item</span> <span class="na">id=</span><span class="s">"msnd_cover15.jpg"</span> <span class="na">href=</span><span class="s">"image/msnd_cover15.jpg"</span> <span class="na">media-type=</span><span class="s">"image/jpeg"</span> <span class="na">properties=</span><span class="s">"cover-image"</span> <span class="nt">/&gt;</span>
</code></pre>
</div>

<p>This we should leave alone!</p>

<h2 id="the-spine">The Spine</h2>

<p>The spine section of the <code class="highlighter-rouge">content.opf</code> file gives the reading order. This will have come from the order of the pages in InDesign or even the the Articles panels. Also, if (like me) you are using the book panel, the order of the InDesign files will affect this spine list.</p>

<p>You can modify this order; let’s say you have a colophon and you would rather have this in the back matter, then you can move the appropriate line to your choice in the sequence.</p>

<p>Here is my spine section:</p>

<div class="language-html highlighter-rouge"><pre class="codehilite"><code><span class="nt">&lt;spine</span> <span class="na">toc=</span><span class="s">'ncx'</span><span class="nt">&gt;</span>
<span class="nt">&lt;itemref</span> <span class="na">idref=</span><span class="s">"cover"</span> <span class="na">linear=</span><span class="s">"no"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;itemref</span> <span class="na">idref=</span><span class="s">"frontmatter"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;itemref</span> <span class="na">idref=</span><span class="s">"dream_preface"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;itemref</span> <span class="na">idref=</span><span class="s">"dream"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;itemref</span> <span class="na">idref=</span><span class="s">"dream-1"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;itemref</span> <span class="na">idref=</span><span class="s">"dream-2"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;itemref</span> <span class="na">idref=</span><span class="s">"dream-3"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;itemref</span> <span class="na">idref=</span><span class="s">"dream-4"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;itemref</span> <span class="na">idref=</span><span class="s">"dream-5"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;itemref</span> <span class="na">idref=</span><span class="s">"dream-6"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/spine&gt;</span>
</code></pre>
</div>

<h2 id="the-guide-section">The Guide Section</h2>

<p>You will notice that under the spine items you will find the Guide section and this is only here for backwards compatibility.</p>

<p>The Guide Section of the package OPF file provides a similar function to the Landmarks section of the ePUB3 navigation document (see later), but harks back to the ePUB2 format.</p>

<p>There is some advantage to adding some items here if you plan to export to the Kindle/MOBI format for Amazon devices; especially if you wish to support earlier versions of these devices. Kindle software does have a drop down menu that can be populated with some items. Here is my Guide section built by InDesign on export:</p>

<div class="language-html highlighter-rouge"><pre class="codehilite"><code><span class="nt">&lt;guide&gt;</span>
 <span class="nt">&lt;reference</span> <span class="na">type=</span><span class="s">"cover"</span> <span class="na">href=</span><span class="s">"cover.xhtml"</span> <span class="na">title=</span><span class="s">"Cover"</span> <span class="nt">/&gt;</span>
 <span class="nt">&lt;reference</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">href=</span><span class="s">"dream_preface.xhtml#_idContainer005"</span> <span class="na">title=</span><span class="s">"Beginning"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/guide&gt;</span>
</code></pre>
</div>

<p>I want to add the Table of Contents in here because Amazon recommend that the TOC should display on the page; this is at odds with the ePUB3 format, where we would rather use the logical version in the eReader interface. So, how can we add an XHTML version of the TOC?</p>

<p>We have one already, because the ePUB3 export has given us - <code class="highlighter-rouge">toc.xhtml</code> - the Table of Contents that is perfectly formed to be displayable. So we use this. Add this line to the <code class="highlighter-rouge">&lt;guide&gt;</code> section to become:</p>

<div class="language-html highlighter-rouge"><pre class="codehilite"><code><span class="nt">&lt;guide&gt;</span>
 <span class="nt">&lt;reference</span> <span class="na">type=</span><span class="s">"TOC"</span> <span class="na">href=</span><span class="s">"toc.xhtml"</span> <span class="na">title=</span><span class="s">"Table of Contents"</span> <span class="nt">/&gt;</span>
 <span class="nt">&lt;reference</span> <span class="na">type=</span><span class="s">"cover"</span> <span class="na">href=</span><span class="s">"cover.xhtml"</span> <span class="na">title=</span><span class="s">"Cover"</span> <span class="nt">/&gt;</span>
 <span class="nt">&lt;reference</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">href=</span><span class="s">"dream_preface.xhtml#_idContainer005"</span>   <span class="na">title=</span><span class="s">"Beginning"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/guide&gt;</span>
</code></pre>
</div>
<p>This change will not effect the ePUB3, but is useful for the Kindle version.</p>

<h2 id="the-metadata-block">The Metadata Block</h2>

<p>We can make some additions to the <code class="highlighter-rouge">&lt;metadata&gt;</code> section of the <code class="highlighter-rouge">content.opf</code> file. You should notice the following line if you opted to embed fonts when you exported to the ePUB:</p>

<div class="language-html highlighter-rouge"><pre class="codehilite"><code><span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">"ibooks:specified-fonts"</span><span class="nt">&gt;</span>true<span class="nt">&lt;/meta&gt;</span>
</code></pre>
</div>

<p>InDesign has put this line into the <code class="highlighter-rouge">content.opf</code> file at the same time as encrypting the fonts that you chose in your paragraph styles. There could be a situation where you want to add this line in to the <code class="highlighter-rouge">&lt;metadata&gt;</code> block. This would be a situation where you are only targeting the Apple devices and you want to use some fonts that are present on the iPad/iOS devices<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>. You don’t need to embed those fonts but you do need to switch on the ‘specified fonts’. So, if you plan to use the fonts that are available on the iOS systems, then do NOT tell InDesign to embed the fonts (when you export, but rather, add this line into the opf file.</p>

<h3 id="let-me-offer-an-example">Let me offer an example.</h3>

<p>So, let’s say that you decide to use avenir-next.</p>

<p>So, build your ePUB with InDesign, with that font used in the paragraph styles.</p>

<p>When you export the ePUB, you can opt to NOT embed the fonts. Then, you will need to add the above line into the content.opf file.</p>

<p>But this line will only make a difference if the package item is included with all of the following:</p>

<div class="language-html highlighter-rouge"><pre class="codehilite"><code><span class="nt">&lt;package</span> <span class="na">version=</span><span class="s">"3.0"</span> <span class="na">xmlns=</span><span class="s">"http://www.idpf.org/2007/opf"</span> <span class="na">unique-identifier=</span><span class="s">"bookid"</span> <span class="na">prefix=</span><span class="s">"ibooks: http://vocabulary.itunes.apple.com/rdf/ibooks/vocabulary-extensions-1.0/"</span> <span class="nt">&gt;</span>
</code></pre>
</div>

<h2 id="orientation-and-spreads">Orientation and Spreads</h2>

<p>If you expand the package section even more as follows:</p>

<div class="language-html highlighter-rouge"><pre class="codehilite"><code><span class="nt">&lt;package</span> <span class="na">xmlns=</span><span class="s">"http://www.idpf.org/2007/opf"</span> <span class="na">unique-identifier=</span><span class="s">"bookid"</span> <span class="na">version=</span><span class="s">"3.0"</span> <span class="na">prefix=</span><span class="s">"rendition: http://www.idpf.org/vocab/rendition/\# ibooks: http://vocabulary.itunes.apple.com/rdf/ibooks/vocabulary-extensions-1.0/"</span><span class="nt">&gt;</span>
</code></pre>
</div>

<p>We have added the extra prefix for rendition and this will also give you the potential to lock the orientation to landscape or portrait.</p>

<p>To lock the orientation on all iOS platforms we can use:</p>

<p><code class="highlighter-rouge">&lt;meta property="rendition:orientation"&gt;portrait&lt;/meta&gt;</code></p>

<p>To lock the orientation on a specific Apple device we can use</p>

<p><code class="highlighter-rouge">&lt;meta property="ibooks:iphone-orientation-lock"&gt;portrait-only&lt;/meta&gt;</code></p>

<h2 id="the-navigation-document-tocxhtml">The Navigation Document (toc.xhtml)</h2>

<p>InDesign CC will create the essential navigation document - toc.xhtml file ePUB3 as well as the ePUB2 equivalent - the toc.ncx file. This latter is provided for backwards compatibility.</p>

<p>All being well, your intelligent construction of the table of contents in InDesign, there should be no good reason to edit the TOC section of these files. Have a look at a sample section of the navigation section of the toc.xhtml file:</p>

<div class="language-xml highlighter-rouge"><pre class="codehilite"><code><span class="nt">&lt;nav</span> <span class="na">id=</span><span class="s">"toc"</span> <span class="na">epub:type=</span><span class="s">"toc"</span><span class="nt">&gt;</span>
<span class="nt">&lt;h2&gt;</span>Contents<span class="nt">&lt;/h2&gt;</span>
<span class="nt">&lt;ol&gt;</span>
<span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"dream_preface.xhtml#_idParaDest-1"</span><span class="nt">&gt;</span>Shakespeare’s Life<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;ol&gt;</span>
<span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"dream_preface.xhtml#_idParaDest-2"</span><span class="nt">&gt;</span>Our Knowledge of Shakespeare<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"dream_preface.xhtml#_idParaDest-3"</span><span class="nt">&gt;</span>Stratford<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"dream_preface.xhtml#_idParaDest-4"</span><span class="nt">&gt;</span>Birth and Parentage<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"dream_preface.xhtml#_idParaDest-5"</span><span class="nt">&gt;</span>Education<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"dream_preface.xhtml#_idParaDest-6"</span><span class="nt">&gt;</span>Marriage<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"dream_preface.xhtml#_idParaDest-7"</span><span class="nt">&gt;</span>Early Life in London<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="nt">&lt;/ol&gt;</span>
<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"dream.xhtml#_idParaDest-8"</span><span class="nt">&gt;</span>Dramatis Personae<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"dream-1.xhtml#_idParaDest-9"</span><span class="nt">&gt;</span>Act I<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;ol&gt;</span>
<span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"dream-1.xhtml#_idParaDest-10"</span><span class="nt">&gt;</span>Scene I<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;ol&gt;</span>
<span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"dream-1.xhtml#_idParaDest-11"</span><span class="nt">&gt;</span>Athens. The palace of Theseus<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
……………… and so on ………
<span class="nt">&lt;/nav&gt;</span>
</code></pre>
</div>

<p>This is a perfectly formed set of nested list items that can be viewed as a web page.</p>

<p><a href="/images/2017/02/editing_ePub/image11.png"><img src="/images/2017/02/editing_ePub/image11.png" alt="Here is what the `toc.xhtml` page looks like if I open in a web browser" /></a></p>

<p>In the image here you will notice another section called the Landmarks.</p>

<h2 id="landmarks">Landmarks</h2>

<p>Landmarks are a feature introduced with the ePUB3 format, and are provided so that eReader software can give the user a means to navigate to particular sections of the eBook. The ePUB format is ready to accept a number of <code class="highlighter-rouge">epub:type</code> values that can be addressed by the eReader software and will enable further navigation aids for the reader.</p>

<p>In later versions of InDesign you are likely to find this section on Landmarks is provided within your <code class="highlighter-rouge">toc.xhtml</code> file when you have selected the ePUB3 format on export.</p>

<p>In my first export to the ePUB, InDesign has given me 2 landmarks entries. Here is why:</p>

<p>The ‘Cover’ entry is there because InDesign has constructed a cover.xhtml file and this is normally not in the reading order of the spine (see the paragraph on The Spine in the section on The OPF Package Document). In eReader software that supports this feature, users can locate the cover from a menu.</p>

<p>The second item (Title-Page) is slightly more complex, and you will need to refer to the work we did in InDesign on our title page. Here is what this looks like in InDesign with the Object Export Options panel open:</p>

<p>As you see here the epub:type is set to title page and this is what provides the item in Landmarks section.</p>

<blockquote>
  <p><strong>Note:</strong> This may look different if you have an earlier version of InDesign.</p>
</blockquote>

<p>The Landmarks section may include ‘cover’, ‘titlepage’, ‘bibliography’ etc. Here is an example:</p>

<p><a href="/images/2017/02/editing_ePub/image12.png"><img src="/images/2017/02/editing_ePub/image12.png" alt="This is where we select the epub:type" /></a></p>

<div class="language-xml highlighter-rouge"><pre class="codehilite"><code><span class="nt">&lt;nav</span> <span class="na">epub:type=</span><span class="s">"landmarks"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;ol&gt;</span>
  <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"cover.xhtml"</span> <span class="na">epub:type=</span><span class="s">"cover"</span><span class="nt">&gt;</span>Cover<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"titlepage.xhtml"</span> <span class="na">epub:type=</span><span class="s">"titlepage"</span><span class="nt">&gt;</span>Title Page<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"introduction.xhtml"</span> <span class="na">epub:type=</span><span class="s">"bodymatter"</span><span class="nt">&gt;</span>Introduction<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
 <span class="nt">&lt;/ol&gt;</span>
<span class="nt">&lt;/nav&gt;</span>
</code></pre>
</div>

<p>This mark-up can be be added to the toc.xhtml file or you might prefer to set this up in InDesign by setting the Object Export Options for particular text frames.</p>

<h2 id="how-can-the-landmarks-help-in-the-way-the-ebook-is-read">How can the Landmarks help in the way the eBook is read?</h2>

<p>The way that the eReader software uses the Landmarks does vary. Some software does not make use of these items at all. For iBooks on Apple devices we can be very specific:</p>

<p>When you distribute the eBook through the Apple iBookstore, Apple will generate a preview of your book. This preview will be constructed from information in the landmarks section.</p>

<p>If you add the following to one of the items in the Landmarks section, the eBook will open on that page:</p>

<p><code class="highlighter-rouge">epub:type="ibooks:reader-start-page"</code></p>

<p>This is from the specific iBooks vocabulary and will only make a difference on Apple devices if you add the following attribute to the HTML tag at the top of the toc.xhtml page:</p>

<div class="language-html highlighter-rouge"><pre class="codehilite"><code><span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">"http://www.w3.org/1999/xhtml"</span> <span class="na">xmlns:epub=</span><span class="s">"http://www.idpf.org/2007/ops"</span> <span class="na">epub:prefix=</span><span class="s">"ibooks: http://vocabulary.itunes.apple.com/rdf/ibooks/vocabulary-extensions-1.0/"</span><span class="nt">&gt;</span>
</code></pre>
</div>

<p>Getting the page to start at a particular location is very difficult to test for because the eReader software (in this case iBooks on Apple devices), will remember your last location in the eBook, so you can only be certain by putting a fresh copy of the ePUB on to your device.</p>

<p>Generally though, one specific item needs to be positioned correctly, with the correct <code class="highlighter-rouge">epub:type</code> so that it becomes the first page that the user sees on opening their eBook.</p>

<p>Probably the most contentious issue here is the cover. The ePUB3 standard seems to presume that you don’t want your readers to see the cover as the first page. I can see the logic here, but if you do want the book to open initially at the cover, then you will need to follow the next paragraph on including the cover page in the flow within the spine section.</p>

<h2 id="pages-outside-the-flow">Pages Outside the Flow</h2>

<p>A more significant controller of your page ordering is the Spine section, where you are likely to find the following:</p>

<div class="language-xml highlighter-rouge"><pre class="codehilite"><code><span class="nt">&lt;itemref</span> <span class="na">idref=</span><span class="s">"cover"</span> <span class="na">linear=</span><span class="s">"no"</span> <span class="nt">/&gt;</span>
</code></pre>
</div>

<p>This means that your cover is not available to your readers other than as a view in the Table of Contents (when in landscape mode on the iPad), or if you have linked in your logical table of contents.</p>

<p>You can rectify this by using:</p>

<p><code class="highlighter-rouge">&lt;itemref idref="cover" linear="yes" /&gt;</code></p>

<p>Users can then navigate to the cover by turning back from your title page.</p>

<h2 id="non-linear-content">Non-Linear Content</h2>

<p>The concept of non-linear content is really important, because it means that you can have pages that will not be found by turning the page, but only through a hyperlink. For example, if you want a References page in your eBook, but you don’t want this page located at the end of the book (viewed by swiping through to that page), then you could edit your toc.xhtml file to include:</p>

<div class="language-html highlighter-rouge"><pre class="codehilite"><code><span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"references.xhtml"</span><span class="nt">&gt;</span>References<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</code></pre>
</div>

<p>But then in the spine use:</p>

<div class="language-xml highlighter-rouge"><pre class="codehilite"><code><span class="nt">&lt;itemref</span> <span class="na">idref=</span><span class="s">"references"</span> <span class="na">linear=</span><span class="s">"no"</span> <span class="nt">/&gt;</span>
</code></pre>
</div>

<p>To prevent the page from being in the flow of pages.</p>

<h2 id="displaying-the-table-of-contents-as-a-page">Displaying the Table of Contents as a Page</h2>

<p>InDesign has been great at building the table of contents for us on export. We opted to keep this TOC off the pages, because we unchecked this page in the Articles panel.</p>

<p>Indesign created an HTML page for the ePUB3 version and this is used as the logical TOC.</p>

<p>But suppose you want to display this in your eBook with some further enhancements?</p>

<p>As you have seen earlier in this chapter, the <code class="highlighter-rouge">toc.xhtml</code> page is a page built with ordered lists, so we should be able to make it look better with some CSS.</p>

<p>We can add some CSS into the head tag of this page.</p>

<p>So I will just go ahead and add that to the <code class="highlighter-rouge">toc.xhtml</code> file.</p>

<p>Now I need to add this to the Spine section of the content.opf file:</p>

<div class="language-xml highlighter-rouge"><pre class="codehilite"><code><span class="nt">&lt;itemref</span> <span class="na">idref=</span><span class="s">"toc"</span> <span class="nt">/&gt;</span>
</code></pre>
</div>

<p>You can see the image of the new page here on the left.</p>

<p><a href="/images/2017/02/editing_ePub/image13.png"><img src="/images/2017/02/editing_ePub/image13.png" alt="Here is the new page for the toc" /></a></p>

<p>I have also hidden the Landmarks section of this navigation document by using this CSS:</p>

<div class="language-css highlighter-rouge"><pre class="codehilite"><code><span class="nt">nav</span><span class="nf">#landmarks</span> <span class="p">{</span><span class="nl">display</span><span class="p">:</span><span class="nb">none</span><span class="p">;}</span>
</code></pre>
</div>

<h2 id="adding-javascript">Adding Javascript</h2>

<p>It is possible to use javascript to your ePUB3 package, for special purposes although this has limited support on devices and eReader software.</p>

<p>The example I am using here will solve a common problem when going from InDesign to ePUB - Balancing Ragged Lines.</p>

<p>In your paragraph styles, under Indents and Spacing, you may have switched on ‘Balance Ragged Lines’. This will be ignored on export to ePUB3 (reflowable), but we can use jquery and some code from Adobe (<em>blogs.adobe.com/webplatform/2013/01/30/balancing-text-for-better-readability/</em>).</p>

<p>We will need to add a class name to the item that we wish to apply this to, so in InDesign for the heading style - be sure to add this to the Export Tagging panel:</p>

<p><a href="/images/2017/02/editing_ePub/image14.png"><img src="/images/2017/02/editing_ePub/image14.png" alt="Adding a second class name " /></a></p>

<p>You will notice that we have 2 class names. This is perfectly correct.</p>

<p>Now we need to add to our own CSS file the following:</p>

<div class="language-css highlighter-rouge"><pre class="codehilite"><code><span class="nt">h2</span><span class="nc">.balance-text</span> <span class="p">{</span>
<span class="nl">text-wrap</span><span class="p">:</span> <span class="n">balanced</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Then we add the following javascript files at the time we export the ePUB3:</p>

<p><code class="highlighter-rouge">jquery-1.6.2.min.js</code></p>

<p><code class="highlighter-rouge">jquery.balancetext.min.js</code></p>

<h2 id="adding-content-with-javascript">Adding Content with Javascript</h2>

<p>jQuery also gives us an easy way to add content to pages.</p>

<p>For example, suppose we want to take a heading and the first paragraph that follows it, and wrap this in a &lt;div&gt; so that we can apply a style to the whole block. We can create a javascript file that includes the following:</p>

<div class="language-javascript highlighter-rouge"><pre class="codehilite"><code><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
 <span class="nx">$</span><span class="p">(</span><span class="s2">".subhead"</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
 <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">next</span><span class="p">(</span><span class="s1">'p'</span><span class="p">).</span><span class="nx">andSelf</span><span class="p">().</span><span class="nx">wrapAll</span><span class="p">(</span><span class="s1">'&lt;div class="staytogether" /&gt;'</span><span class="p">);</span>
 <span class="p">});</span>
<span class="p">});</span>
</code></pre>
</div>

<p>We then add some style to the CSS like this:</p>

<div class="language-css highlighter-rouge"><pre class="codehilite"><code><span class="nt">div</span><span class="nc">.staytogether</span> <span class="p">{</span>
<span class="nl">page-break-inside</span><span class="p">:</span><span class="nb">avoid</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="adding-content-with-css">Adding Content with CSS</h2>

<p>CSS also has the potential for us to add some content at run-time.</p>

<p>In this example we are going to add a flourish before and after the scene name in the play.</p>

<p>The CSS we need is:</p>

<div class="language-css highlighter-rouge"><pre class="codehilite"><code><span class="nc">.scene</span><span class="nd">::before</span><span class="o">,</span> <span class="nc">.scene</span><span class="nd">::after</span> <span class="p">{</span>
 <span class="nl">font-family</span><span class="p">:</span><span class="n">ZapfDingbatsITC</span><span class="p">;</span>
 <span class="nl">content</span><span class="p">:</span><span class="s2">'✣'</span><span class="p">;</span>
 <span class="nl">font-weight</span><span class="p">:</span><span class="nb">normal</span><span class="p">;</span>
 <span class="nl">font-size</span><span class="p">:</span><span class="m">1em</span><span class="p">;</span>
 <span class="nl">vertical-align</span><span class="p">:</span><span class="nb">middle</span><span class="p">;</span>
 <span class="nl">color</span><span class="p">:</span><span class="m">#6bc77e</span><span class="p">;</span>
 <span class="nl">margin</span><span class="p">:</span><span class="m">0</span> <span class="m">10px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p><a href="/images/2017/02/editing_ePub/image15.png"><img src="/images/2017/02/editing_ePub/image15.png" alt="Content added with CSS" /></a></p>

<h2 id="summary">Summary</h2>

<p>This chapter has shown you some of the edits you can make to the inner workings of the ePUB package.</p>

<p>Remember, if you want to ‘roundtrip’ back to InDesign then you will need to keep a record of these changes so that you can re-instate them, when InDesign overwrites your ePUB file. It is possible to add your own CSS at export time, but all other changes (to the package documents, toc.xhtml, landmarks etc.)- these will be lost at export time.</p>

<p>As time goes on, the export to ePUB3 feature of InDesign will no doubt improve, and so it may be that we will have more control over the output without having to make any edits inside the ePUB package.</p>

<p>Until that time — have fun!</p>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>The fonts that are available on the iOS devices are listed here: <em><a href="http://iosfonts.com">iosfonts.com</a></em>&nbsp;<a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

</div>

        
        <p><b>Filed under:</b> ePub</p>
        

      </div>

    </div>
<!-- <footer>
<p><a style="float:right;" rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons Licence" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png" /></a>
&#169; Chris Jennings 2017</p>
</footer>
 -->
<!-- now follows items that get the menu working -->
    <label title="the menu" for="sidebar-checkbox" class="sidebar-toggle fa fa-chevron-left fa-lg" aria-hidden="true"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');
        document.addEventListener('click', function(e) {
          var target = e.target;
          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;
          checkbox.checked = false;
        }, false);
      })(document);
    </script>
    <script>
        $(document).ready(function() {
            $('.fancybox').fancybox();
        });
    </script>
    <script>
    jQuery(document).ready(function($) {
    	$("img:not([title])").each(function() {
    			if($(this).attr("alt") != '') $(this).parent().attr("title", $(this).attr("alt"))
    			else $(this).parent().attr("title", $(this).attr("src"));
    	});
    });
    </script>
    <script>
        $("a[href$='.jpg'],a[href$='.jpeg'],a[href$='.png'],a[href$='.gif']").attr('rel', 'gallery').attr('class', 'sideimage').fancybox();
    </script>

    <!-- show a video -->


    <script>
    $(document).ready(function() {
    	$(".video").fancybox({
    		maxWidth	: 800,
    		maxHeight	: 600,
    		fitToView	: false,
    		width		: '70%',
    		height		: '70%',
    		autoSize	: false,
    		closeClick	: false,
    		openEffect	: 'none',
    		closeEffect	: 'none'
    	});
    });
    </script>

    <!-- navigation -->
    <script>
    jQuery(document).ready(function(){

    $(".navigation > li > a").on("click", function(e){

    	if(!$(this).hasClass("active")) {

          // hide any open menus and remove all other classes
    		$(".navigation li ul").slideUp(350);
    		$(".navigation li a").removeClass("active");

    		// open our new menu and add the open class
    		$(this).next("ul").slideDown(350);
    		$(this).addClass("active");

    	}else if($(this).hasClass("active")) {

    		$(this).removeClass("active");
    		$(this).next("ul").slideUp(350);
    	}
       e.preventDefault();
    });

    });
    </script>
  </body>
</html>
